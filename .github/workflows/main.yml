name: RetroArch iOS Build (no codesign)

on:
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # ★ ここに追加する
      - name: Set Xcode version
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: '26.1'

      - name: Install dependencies
        run: |
          brew update
          brew install unzip

      - name: Build RetroArch iOS (no codesign)
        env:
          NOCODESIGN: 1
        run: |
          cd pkg/apple
          chmod +x script/build
          script/build

      - name: Collect .app for artifact
        run: |
          mkdir -p pkg/apple/iOS/build/Release-iphoneos
          cp -R ~/Library/Developer/Xcode/DerivedData/RetroArch_iOS13-*/Build/Products/Release-iphoneos/RetroArch.app \
            pkg/apple/iOS/build/Release-iphoneos/

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: RetroArch-iOS-build
          path: pkg/apple/iOS/build/Release-iphoneos
